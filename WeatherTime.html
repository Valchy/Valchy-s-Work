<html>
<head>
<meta charset="utf-8">
<title> Weather &amp; Time </title>
<script type="text/javascript" src="jquery-3.2.1.min.js"> </script>
<link rel="shortcut icon" href="hi.png" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="EverythingCSS.css" type="text/css">
<style type="text/css">
h3 {text-align: center;}
h1 {margin-bottom: 0px; padding-bottom: 0px;}
#map {width: 100%; height: 400px; background-color: grey; margin-bottom: 20px;}
#DivID {background-color: white; border-radius: 20px; border: 1px solid black; width: 200px; height: 200px; padding: 10px;}
</style>
</head>

<body>
<div id="mainBarOthers" class="mainBarOthers">
	<ul class="theUl" id="theUl">	
	</ul>
</div>

<div class="mainPage">
	<h1> Using API (AJAX &amp; AJAX) to show local Weather and Time </h1>

	<div id="userCoordinates"> Your Coordinates: </div>

	<h3> My Google Maps Demo </h3>
	<div id="map"></div>

	<div id="DivID"></div>
</div>

<script type="text/javascript" src="EverythingJS.js"> </script>
<script type="text/javascript">
var coordinatesDiv = document.getElementById('userCoordinates');
var userLAT;
var userLON;
var tempHTML;

function mapsCall () {
	if (navigator.geolocation) {
       userData = navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else { 
        coordinatesDiv.innerHTML = "Geolocation is not supported by this browser :(";
    }
}

function pullingInformation () {
	var data = new XMLHttpRequest();
	data.open('GET', 'http://api.openweathermap.org/data/2.5/weather?lat='+userLAT+'&lon='+userLON+'&appid=ce08873d7abcedcca577c81c3a1d0689');

	data.onload = function () {
		if (data.status >= 200 && data.status < 400) {
			// Different types of JSON.random() Examples are: parse() and stringify();
            // Ask for more information about the topic what exactly does a specific method
			var ourData = JSON.parse(data.responseText);
			WeatherHTML(ourData);
			$('#DivID').html(tempHTML);
		}
		else {
			$('#DivID').html('Server failure, please try again!');
		}
	};

	data.onerror = function () {
		$('#DivID').html('Connection error ocurred, please try again!');
	}

	data.send();

	var userLatLan = {lat: userLAT, lng: userLON};
    var map = new google.maps.Map(document.getElementById('map'), {
    	zoom: 6,
   		center: userLatLan
    });
    var marker = new google.maps.Marker ({
    	position: userLatLan,
    	map: map
	});
}

function showPosition(position) {
    var latlon = position.coords.latitude + "," + position.coords.longitude;
    userLON = position.coords.longitude;
    userLAT = position.coords.latitude;

    if (latlon.length < 1) {
    	coordinatesDiv.innerHTML += ' Blocked by user';
    }
    else {
    	coordinatesDiv.innerHTML += ' '+position.coords.longitude+' and '+position.coords.latitude;
    }

    pullingInformation();
}

// Error Handling
function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            coordinatesDiv.innerHTML = "User denied the request for Geolocation."
            break;
        case error.POSITION_UNAVAILABLE:
            coordinatesDiv.innerHTML = "Location information is unavailable."
            break;
        case error.TIMEOUT:
            coordinatesDiv.innerHTML = "The request to get user location timed out."
            break;
        case error.UNKNOWN_ERROR:
            coordinatesDiv.innerHTML = "An unknown error occurred."
            break;
    }
}

function WeatherHTML (data) {
	tempHTML = data;
	var hi = tempHTML.coord.lon;
	tempHTML = hi;
	return tempHTML;
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-pRxQlYylkY06uuriuxmMPBuoaOnlD-Y&callback=mapsCall"> </script>
</body>
</html>

<!--
Use an api from a weather and time website and use the information (ajax json) to show the current weather and time on the usrs city. Make it look nice and then also impliment it
on the actual website :D
-->