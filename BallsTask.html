<html>
<head>
<meta charset="utf-8">
<title> Balls Task </title>
<script type="text/javascript" src="jquery-3.2.1.min.js"> </script>
<script type="text/javascript" src="three.min.js"></script>
<script type="text/javascript" src="three.js"></script>
<script type="text/javascript" src="OrbitControls.js"></script>
<script type="text/javascript" src="DragControls.js"></script>
<link rel="shortcut icon" href="hi.png" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="EverythingCSS.css" type="text/css">
<style type="text/css">
canvas {width: 1300; height: 700; margin-left: 20%;}
</style>
</head>

<body>
<div id="mainBarOthers" class="mainBarOthers">
	<ul class="theUl" id="theUl">	
	</ul>
</div>

<div class="mainPage">
	<h1> Balls Task (Three.js) </h1>
</div>

<div id="OnError"> </div>

<!-- Very important how I place my JavaScript Sources since putting the controls one first for example breaks the code -->
<script type="text/javascript" src="EverythingJS.js"> </script>
<script type="text/javascript">
var startDrawing = false;
var sphereCounter = 1;
var cameraMovement = 1;
var allowUpdate = false;
var sphereData = [];

pull();

	function pull () {
		var data = new XMLHttpRequest();
		data.open('GET', 'https://valchy.github.io/br_accepted_r5.txt');
		data.onload = function () {
			if (data.status >= 200 && data.status < 400) {
				var ourData = data.responseText;
				sphereData = ourData.split("\n");
				ThreeJS();
			}
			else {
				$('#OnError').html('Server failure, please try again!');
				console.log('Server failure, please try again!');
			}
		};
		data.onerror = function () {
			$('#OnError').html('Connection lost, please fix and try again!');
			console.log('Connection lost, please fix and try again!');
		};
		data.send();
	}

	function decToHex(num) {
		var hexNum = num.toString(16);
		console.log(hexNum);
		return hexNum;
	}

	function ThreeJS () {
		var tempInfo;

		// I can use eventListener to chnage the width of the canvas on 'resize' (to calculate the aspect ratio do width/height)
		// Need to knwo methods are: camera.aspect = width / height; && camera.updateProjectionMatrix();
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(75, 1300/700, 0.1, 1000);

		var renderer = new THREE.WebGLRenderer({alpha: true});
		renderer.setSize(1300, 700);
		// This creates the canvas
		document.body.appendChild(renderer.domElement);
		// Adds a mouse control option
		var controls = new THREE.OrbitControls(camera, renderer.domElement);

		for (var i = 0; i < sphereData.length-1; i++) {
			if (sphereCounter <= sphereData[sphereCounter].length) {
				tempInfo = sphereData[sphereCounter];
				var verytemp = tempInfo.split(" ");
				var hexString = verytemp[25];
				decToHex(hexString);
			}

			if (verytemp[0] == 4) { // Parametars: radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength
				var geometry = new THREE.SphereGeometry(verytemp[5]);
				var material = new THREE.MeshBasicMaterial({color: 0xff0000, wireframe: false});
				var mesh = new THREE.Mesh(geometry, material);
				scene.add(mesh);
				mesh.position.set(verytemp[1], verytemp[2], verytemp[3]);
				sphereCounter++;
				if (sphereCounter == 1111111111) {
					// Fix movement :D
					allowUpdate = true;
				}
			}
			else if (verytemp[0] == 12) {	// false makes the top and bottom bar show or hide
				var geometry = new THREE.CylinderGeometry(50, 50, 220, 10, 0.1, false, 0, Math.PI);
				var material = new THREE.MeshBasicMaterial({color: 0xffff00, wireframe: true});
				var mesh = new THREE.Mesh(geometry, material);
				scene.add(mesh);
				mesh.position.set(verytemp[5], verytemp[6], verytemp[1]);
				sphereCounter++;
			}
		}

		// Changes camera position
		camera.position.z = 200;
		camera.position.x = 100;
		camera.rotation.x = 0;

		var update = function () {

			if (cameraMovement == 1) {
				camera.position.z += 0.5;
				if (camera.position.z == 250) {
					cameraMovement = 2;
				}
			}
			else {
				camera.position.z -= 0.5;
				if (camera.position.z == 209) {
					cameraMovement = 1;
				}
			}
		};

		var render = function () {
			renderer.render(scene, camera);
		};

		var theLoop = function () {
			requestAnimationFrame(theLoop);
			update();
			render();
		};

		theLoop();
	}
</script>
</body>
</html>

<!--
Да се направи изображение на топка в полу-цилиндри. Чрез графичната библиотека 'Three.js' и инфо от имейла.
-->