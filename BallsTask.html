<html>
<head>
<meta charset="utf-8">
<title> Balls Task </title>
<script type="text/javascript" src="jquery-3.2.1.min.js"> </script>
<script type="text/javascript" src="three.min.js"></script>
<script type="text/javascript" src="three.js"></script>
<script type="text/javascript" src="OrbitControls.js"></script>
<link rel="shortcut icon" href="hi.png" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="EverythingCSS.css" type="text/css">
<style type="text/css">
canvas {width: 1300; height: 700; margin-left: 20%;}
</style>
</head>

<body>
<div id="mainBarOthers" class="mainBarOthers">
	<ul class="theUl" id="theUl">	
	</ul>
</div>

<div class="mainPage">
	<h1> Balls Task (Three.js) </h1>
</div>

<div id="OnError"> </div>

<!-- Very important how I place my JavaScript Sources since putting the controls one first for example breaks the code -->
<script type="text/javascript" src="EverythingJS.js"> </script>
<script type="text/javascript">
var startDrawing = false;
var sphereCounter = 0;
var cameraMovement = 1;
var allowUpdate = false;
var sphereData = [];

	function pull () {
		var data = new XMLHttpRequest();
		data.open('GET', 'https://valchy.github.io/br_accepted_r1.txt');
		data.onload = function () {
			if (data.status >= 200 && data.status < 400) {
				var ourData = data.responseText;
				sphereData = ourData.split("\n");
				ThreeJS();
			}
			else {
				$('#OnError').html('Server failure, please try again!');
				console.log('Server failure, please try again!');
			}
		};
		data.onerror = function () {
			$('#OnError').html('Connection lost, please fix and try again!');
			console.log('Connection lost, please fix and try again!');
		};
		data.send();
	}

	function ThreeJS () {
		var tempInfo;

		// I can use eventListener to chnage the width of the canvas on 'resize' (to calculate the aspect ratio do width/height)
		// Need to knwo methods are: camera.aspect = width / height; && camera.updateProjectionMatrix();
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(75, 1300/700, 0.1, 1000);

		var renderer = new THREE.WebGLRenderer();
		renderer.setSize(1300, 700);
		// This creates the canvas
		document.body.appendChild(renderer.domElement);
		controls = new THREE.OrbitControls(camera, renderer.domElement);

		for (var i = 3; i < sphereData.length; i++) {
			if (sphereCounter <= sphereData[sphereCounter].length) {
				tempInfo = sphereData[sphereCounter];
				sphereCounter++;
				console.log(tempInfo);
			}
			else {
				allowUpdate = true;
			}
			var geometry = new THREE.SphereGeometry(7.94, 32, 16);
			var material = new THREE.MeshBasicMaterial({color: 0xffff00, wireframe: true});
			var sphere = new THREE.Mesh(geometry, material);
			scene.add(sphere);
		}

		// Changes camera position
		camera.position.z = 45;

		var update = function () {
			if (allowUpdate == true) {
				// This makes the cube rotate
				sphere.rotation.x += 0.01;
				sphere.rotation.y += 0.008;
				if (cameraMovement == 1) {
					camera.position.z += 0.5;
					if (camera.position.z == 50) {
						cameraMovement = 2;
					}
				}
				else {
					camera.position.z -= 0.5;
					if (camera.position.z == 9) {
						cameraMovement = 1;
					}
				}
			}
			else {
				return;
			}
		};

		var render = function () {
			renderer.render(scene, camera);
		};

		// Try changing the title of var if it works
		var theLoop = function () {
			requestAnimationFrame(theLoop);
			update();
			render();
		};

		theLoop();
	}

	pull();
</script>
</body>
</html>

<!--
Да се направи изображение на топка в полу-цилиндри. Чрез графичната библиотека 'Three.js' и инфо от имейла.
-->